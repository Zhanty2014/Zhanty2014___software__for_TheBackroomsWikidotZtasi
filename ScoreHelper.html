<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分数学习助手 - 完整版</title>
    <style>
        :root {
            --primary: #4a6cf7;
            --primary-light: #e0e7ff;
            --secondary: #f0932b;
            --dark: #1d2144;
            --light: #f8f9fa;
            --success: #28a745;
            --danger: #dc3545;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), #2d55d4);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            text-align: center;
            min-width: 100px;
            flex: 1;
        }
        
        .tab:hover {
            background-color: var(--primary-light);
        }
        
        .tab.active {
            background-color: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
        }
        
        .fraction {
            display: inline-block;
            text-align: center;
            margin: 0 5px;
            font-size: 1.2rem;
            vertical-align: middle;
        }
        
        .fraction .numerator {
            display: block;
            border-bottom: 1px solid var(--dark);
            padding: 0 5px;
            min-width: 20px;
            text-align: center;
        }
        
        .fraction .denominator {
            display: block;
            padding: 0 5px;
            min-width: 20px;
            text-align: center;
        }
        
        .visual-fraction {
            display: inline-block;
            width: 150px;
            height: 150px;
            border: 2px solid var(--dark);
            position: relative;
            margin: 10px;
            vertical-align: top;
            overflow: hidden;
        }
        
        .fraction-part {
            position: absolute;
            background-color: var(--primary);
            opacity: 0.7;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        input, select, button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            white-space: nowrap;
        }
        
        button:hover {
            background-color: #3a56d4;
            transform: translateY(-2px);
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--border-radius);
            background-color: var(--primary-light);
            font-weight: 600;
        }
        
        .correct {
            background-color: #e7f7e9;
            color: var(--success);
            border-left: 4px solid var(--success);
        }
        
        .incorrect {
            background-color: #fce8e8;
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }
        
        .comparison-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .fraction-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .operation-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .operation-btn {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .operation-btn.active {
            background-color: var(--primary);
            color: white;
        }
        
        .simplify-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .step-by-step {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--secondary);
        }
        
        .step {
            margin-bottom: 10px;
        }
        
        /* 练习区域样式 */
        .practice-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .practice-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: var(--primary-light);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            flex: 1;
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .question-container {
            background: #f8f9fa;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .question-text {
            font-size: 1.3rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option {
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .option.selected {
            border-color: var(--primary);
            background-color: var(--primary-light);
            transform: scale(1.05);
        }
        
        .option.correct-answer {
            border-color: var(--success);
            background-color: #e7f7e9;
        }
        
        .option.wrong-answer {
            border-color: var(--danger);
            background-color: #fce8e8;
        }
        
        .answer-input {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .answer-input .fraction {
            font-size: 1.5rem;
        }
        
        .fraction-input-inline {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 10px;
        }
        
        .fraction-input-inline input {
            width: 80px;
            text-align: center;
        }
        
        .fraction-input-inline hr {
            width: 100%;
            margin: 5px 0;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--border-radius);
            display: none;
        }
        
        .feedback.correct {
            display: block;
            background-color: #e7f7e9;
            color: var(--success);
            border-left: 4px solid var(--success);
        }
        
        .feedback.incorrect {
            display: block;
            background-color: #fce8e8;
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }
        
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* 动画演示区域样式 */
        .animation-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .animation-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .animation-stage {
            width: 100%;
            min-height: 300px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            position: relative;
            overflow: hidden;
            border: 2px dashed #dee2e6;
        }
        
        .fraction-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            font-size: 1.5rem;
            flex-wrap: wrap;
        }
        
        .operation-symbol {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .equals-symbol {
            font-size: 2rem;
            font-weight: bold;
            margin: 0 15px;
        }
        
        .visualization-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dee2e6;
            transition: all 0.3s;
        }
        
        .step-dot.active {
            background: var(--primary);
            transform: scale(1.2);
        }
        
        .step-description {
            text-align: center;
            margin-top: 15px;
            padding: 15px;
            background: var(--primary-light);
            border-radius: var(--border-radius);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .animation-progress-container {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .comparison-container {
                flex-direction: column;
            }
            
            .operation-selector {
                flex-wrap: wrap;
            }
            
            .practice-controls {
                flex-direction: column;
            }
            
            .practice-stats {
                flex-direction: column;
            }
            
            .fraction-display {
                flex-direction: column;
                gap: 10px;
            }
            
            .visualization-area {
                flex-direction: column;
            }
            
            .answer-input {
                flex-direction: column;
                align-items: center;
            }
            
            .option {
                font-size: 1.2rem;
                padding: 12px;
            }
        }
        
        /* 动画效果 */
        @keyframes highlight {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); box-shadow: 0 0 15px rgba(74, 108, 247, 0.7); }
            100% { transform: scale(1); }
        }
        
        .highlight {
            animation: highlight 1s ease;
        }
        
        @keyframes moveFraction {
            0% { transform: translateX(0); }
            50% { transform: translateX(50px); }
            100% { transform: translateX(0); }
        }
        
        .moving {
            animation: moveFraction 2s ease-in-out;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .flip {
            animation: flip 1s ease;
        }
        
        @keyframes flip {
            0% { transform: rotateY(0); }
            50% { transform: rotateY(180deg); }
            100% { transform: rotateY(0); }
        }
        
        /* 新添加的样式 */
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        button:disabled:hover {
            background-color: #cccccc;
            transform: none;
        }
        
        .submit-btn-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .submit-btn-container button {
            padding: 12px 30px;
            font-size: 1.1rem;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .input-group label {
            font-weight: 500;
        }
        
        /* 转换区域样式 */
        .convert-section {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }
        
        .decimal-section {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }
        
        /* 错题本样式 */
        .mistake-item {
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            border-left: 4px solid var(--danger);
            box-shadow: var(--shadow);
        }
        
        .mistake-item .question {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .mistake-item .answer {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .mistake-item .user-answer {
            color: var(--danger);
        }
        
        .mistake-item .correct-answer {
            color: var(--success);
        }
        
        .mistake-item .timestamp {
            font-size: 0.9rem;
            color: #666;
            text-align: right;
        }
        
        /* 帮助按钮样式 */
        .help-btn {
            background-color: #6c757d !important;
        }
        
        .help-btn:hover {
            background-color: #5a6268 !important;
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-content h3 {
            margin-top: 0;
            color: var(--primary);
        }
        
        .modal-close {
            margin-top: 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
        }
        
        /* 统计区域样式 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .type-stat {
            background: var(--primary-light);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
        }
        
        .type-stat h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        /* 分数显示增强 */
        .mixed-fraction {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .mixed-fraction .whole {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>分数学习助手</h1>
            <p class="subtitle">探索、练习和掌握分数的交互式工具</p>
        </div>
    </header>
    
    <div class="container">
        <div class="nav-tabs">
            <div class="tab active" data-tab="intro">分数介绍</div>
            <div class="tab" data-tab="visualize">可视化分数</div>
            <div class="tab" data-tab="compare">比较分数</div>
            <div class="tab" data-tab="operations">分数运算</div>
            <div class="tab" data-tab="simplify">分数简化</div>
            <div class="tab" data-tab="convert">分数转换</div>
            <div class="tab" data-tab="decimal">分数小数互转</div>
            <div class="tab" data-tab="practice">练习</div>
            <div class="tab" data-tab="animation">动画演示</div>
            <div class="tab" data-tab="mistakes">错题本</div>
            <div class="tab" data-tab="stats">学习统计</div>
        </div>
        
        <!-- 分数介绍 -->
        <div id="intro" class="tab-content active">
            <h2 class="section-title">分数基础知识</h2>
            <p>分数表示一个整体被分成若干等份中的一部分。分数由分子和分母组成：</p>
            
            <div class="fraction">
                <span class="numerator">分子</span>
                <span class="denominator">分母</span>
            </div>
            
            <p>分子表示被选取的部分数量，分母表示整体被分成的总份数。</p>
            
            <h3>分数的类型</h3>
            <ul>
                <li><strong>真分数</strong>：分子小于分母，如 <span class="fraction"><span class="numerator">3</span><span class="denominator">4</span></span></li>
                <li><strong>假分数</strong>：分子大于或等于分母，如 <span class="fraction"><span class="numerator">5</span><span class="denominator">4</span></span></li>
                <li><strong>带分数</strong>：由整数和真分数组成，如 1<span class="fraction"><span class="numerator">1</span><span class="denominator">4</span></span></li>
            </ul>
            
            <h3>等价分数</h3>
            <p>不同的分数可以表示相同的值，如 <span class="fraction"><span class="numerator">1</span><span class="denominator">2</span></span> = <span class="fraction"><span class="numerator">2</span><span class="denominator">4</span></span> = <span class="fraction"><span class="numerator">3</span><span class="denominator">6</span></span></p>
            
            <div class="controls">
                <button id="helpIntro" class="help-btn">帮助</button>
            </div>
        </div>
        
        <!-- 可视化分数 -->
        <div id="visualize" class="tab-content">
            <h2 class="section-title">分数可视化</h2>
            <p>使用下面的工具创建和可视化分数：</p>
            
            <div class="controls">
                <div class="input-group">
                    <label for="visNumerator">分子:</label>
                    <input type="number" id="visNumerator" min="0" max="100" value="3">
                </div>
                <div class="input-group">
                    <label for="visDenominator">分母:</label>
                    <input type="number" id="visDenominator" min="1" max="100" value="4">
                </div>
                <div class="input-group">
                    <label for="visType">可视化类型:</label>
                    <select id="visType">
                        <option value="circle">圆形</option>
                        <option value="rectangle">矩形</option>
                    </select>
                </div>
                <button id="updateVisualization">更新可视化</button>
                <button id="helpVisualize" class="help-btn">帮助</button>
            </div>
            
            <div id="visualizationContainer">
                <!-- 通过JS动态生成 -->
            </div>
            
            <div class="result" id="visualizationResult">
                分数: <span class="fraction"><span class="numerator">3</span><span class="denominator">4</span></span>
            </div>
        </div>
        
        <!-- 比较分数 -->
        <div id="compare" class="tab-content">
            <h2 class="section-title">比较分数</h2>
            <p>比较两个分数的大小：</p>
            
            <div class="comparison-container">
                <div class="fraction-input">
                    <input type="number" id="num1" min="0" max="100" value="3">
                    <hr style="width: 50px;">
                    <input type="number" id="den1" min="1" max="100" value="4">
                </div>
                
                <div>
                    <button id="compareBtn">比较</button>
                </div>
                
                <div class="fraction-input">
                    <input type="number" id="num2" min="0" max="100" value="2">
                    <hr style="width: 50px;">
                    <input type="number" id="den2" min="1" max="100" value="3">
                </div>
            </div>
            
            <div class="result" id="comparisonResult">
                点击"比较"按钮查看结果
            </div>
            
            <div class="visualization-area">
                <div class="visual-fraction" id="compareFraction1"></div>
                <div class="visual-fraction" id="compareFraction2"></div>
            </div>
            
            <div class="controls">
                <button id="helpCompare" class="help-btn">帮助</button>
            </div>
        </div>
        
        <!-- 分数运算 -->
        <div id="operations" class="tab-content">
            <h2 class="section-title">分数运算</h2>
            <p>练习分数的加、减、乘、除运算：</p>
            
            <div class="operation-selector">
                <div class="operation-btn active" data-operation="add">+</div>
                <div class="operation-btn" data-operation="subtract">-</div>
                <div class="operation-btn" data-operation="multiply">×</div>
                <div class="operation-btn" data-operation="divide">÷</div>
            </div>
            
            <div class="comparison-container">
                <div class="fraction-input">
                    <input type="number" id="opNum1" min="0" max="20" value="1">
                    <hr style="width: 50px;">
                    <input type="number" id="opDen1" min="1" max="20" value="2">
                </div>
                
                <div id="operationSymbol">+</div>
                
                <div class="fraction-input">
                    <input type="number" id="opNum2" min="0" max="20" value="1">
                    <hr style="width: 50px;">
                    <input type="number" id="opDen2" min="1" max="20" value="3">
                </div>
                
                <div>=</div>
                
                <div class="fraction-input">
                    <input type="number" id="resultNum" placeholder="?">
                    <hr style="width: 50px;">
                    <input type="number" id="resultDen" placeholder="?">
                </div>
            </div>
            
            <div class="controls">
                <button id="calculateBtn">计算</button>
                <button id="checkBtn">检查答案</button>
                <button id="newProblemBtn">新问题</button>
                <button id="helpOperations" class="help-btn">帮助</button>
            </div>
            
            <div class="result" id="operationResult">
                输入答案并点击"检查答案"
            </div>
            
            <div class="step-by-step" id="stepByStep">
                <!-- 通过JS动态生成 -->
            </div>
        </div>
        
        <!-- 分数简化 -->
        <div id="simplify" class="tab-content">
            <h2 class="section-title">分数简化</h2>
            <p>将分数简化到最简形式：</p>
            
            <div class="controls">
                <div class="fraction-input">
                    <input type="number" id="simplifyNum" min="-1000" max="1000" value="8">
                    <hr style="width: 50px;">
                    <input type="number" id="simplifyDen" min="1" max="1000" value="12">
                </div>
                <button id="simplifyBtn">简化分数</button>
                <button id="helpSimplify" class="help-btn">帮助</button>
            </div>
            
            <div class="result" id="simplifyResult">
                简化结果将显示在这里
            </div>
            
            <div class="step-by-step" id="simplifySteps">
                <!-- 通过JS动态生成 -->
            </div>
        </div>
        
        <!-- 分数转换 -->
        <div id="convert" class="tab-content">
            <h2 class="section-title">分数转换</h2>
            <p>在带分数和假分数之间进行转换：</p>
            
            <div class="controls">
                <div class="input-group">
                    <label for="convertType">转换类型:</label>
                    <select id="convertType">
                        <option value="improper-to-mixed">假分数 → 带分数</option>
                        <option value="mixed-to-improper">带分数 → 假分数</option>
                    </select>
                </div>
                <button id="helpConvert" class="help-btn">帮助</button>
            </div>
            
            <!-- 假分数转带分数区域 -->
            <div id="improperToMixed" class="convert-section">
                <h3>假分数转换为带分数</h3>
                <div class="controls">
                    <div class="fraction-input">
                        <input type="number" id="impNum" min="1" max="100" value="7">
                        <hr style="width: 50px;">
                        <input type="number" id="impDen" min="1" max="100" value="3">
                    </div>
                    <button id="convertImproperBtn">转换为带分数</button>
                </div>
            </div>
            
            <!-- 带分数转假分数区域 -->
            <div id="mixedToImproper" class="convert-section" style="display: none;">
                <h3>带分数转换为假分数</h3>
                <div class="controls">
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <input type="number" id="mixedWhole" min="1" max="100" value="2" placeholder="整数">
                        <div class="fraction-input">
                            <input type="number" id="mixedNum" min="1" max="100" value="1" placeholder="分子">
                            <hr style="width: 50px;">
                            <input type="number" id="mixedDen" min="1" max="100" value="3" placeholder="分母">
                        </div>
                    </div>
                    <button id="convertMixedBtn">转换为假分数</button>
                </div>
            </div>
            
            <div class="result" id="convertResult">
                转换结果将显示在这里
            </div>
            
            <div class="step-by-step" id="convertSteps">
                <!-- 通过JS动态生成 -->
            </div>
        </div>
        
        <!-- 分数小数互转 -->
        <div id="decimal" class="tab-content">
            <h2 class="section-title">分数与小数互转</h2>
            <p>在分数和小数之间进行转换：</p>
            
            <div class="controls">
                <div class="input-group">
                    <label for="decimalConvertType">转换类型:</label>
                    <select id="decimalConvertType">
                        <option value="fraction-to-decimal">分数 → 小数</option>
                        <option value="decimal-to-fraction">小数 → 分数</option>
                    </select>
                </div>
                <button id="helpDecimal" class="help-btn">帮助</button>
            </div>
            
            <!-- 分数转小数区域 -->
            <div id="fractionToDecimal" class="decimal-section">
                <h3>分数转换为小数</h3>
                <div class="controls">
                    <div class="fraction-input">
                        <input type="number" id="fracDecNum" min="1" max="100" value="3">
                        <hr style="width: 50px;">
                        <input type="number" id="fracDecDen" min="1" max="100" value="4">
                    </div>
                    <button id="convertFractionToDecimalBtn">转换为小数</button>
                </div>
            </div>
            
            <!-- 小数转分数区域 -->
            <div id="decimalToFraction" class="decimal-section" style="display: none;">
                <h3>小数转换为分数</h3>
                <div class="controls">
                    <div class="input-group">
                        <label for="decimalNum">小数:</label>
                        <input type="number" id="decimalNum" step="0.001" min="0.001" max="99.999" value="0.75">
                    </div>
                    <button id="convertDecimalToFractionBtn">转换为分数</button>
                </div>
            </div>
            
            <div class="result" id="decimalConvertResult">
                转换结果将显示在这里
            </div>
            
            <div class="step-by-step" id="decimalConvertSteps">
                <!-- 通过JS动态生成 -->
            </div>
        </div>
        
        <!-- 练习区域 -->
        <div id="practice" class="tab-content">
            <h2 class="section-title">分数练习</h2>
            <p>通过练习巩固你的分数知识。选择题目类型并开始练习！</p>
            
            <div class="practice-controls">
                <div class="input-group">
                    <label for="practiceType">题目类型:</label>
                    <select id="practiceType">
                        <option value="comparison">比较分数</option>
                        <option value="simplification">分数简化</option>
                        <option value="addition">分数加法</option>
                        <option value="subtraction">分数减法</option>
                        <option value="multiplication">分数乘法</option>
                        <option value="division">分数除法</option>
                        <option value="mixed">混合练习</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="difficulty">难度:</label>
                    <select id="difficulty">
                        <option value="easy">简单</option>
                        <option value="medium">中等</option>
                        <option value="hard">困难</option>
                    </select>
                </div>
                <button id="startPractice">开始练习</button>
                <button id="helpPractice" class="help-btn">帮助</button>
                <button id="nextQuestion" style="display: none;">下一题</button>
            </div>
            
            <div class="progress-bar">
                <div class="progress" id="practiceProgress"></div>
            </div>
            
            <div class="practice-stats">
                <div class="stat-box">
                    <div class="stat-value" id="score">0</div>
                    <div>得分</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="correctCount">0</div>
                    <div>正确</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="incorrectCount">0</div>
                    <div>错误</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="questionCount">0</div>
                    <div>题目</div>
                </div>
            </div>
            
            <div id="practiceContainer" style="display: none;">
                <div class="question-container">
                    <div class="question-text" id="practiceQuestion"></div>
                    
                    <div id="multipleChoiceOptions" class="options" style="display: none;">
                        <!-- 选项将通过JS动态生成 -->
                    </div>
                    
                    <div id="inputAnswer" class="answer-input" style="display: none;">
                        <div class="fraction-input-inline">
                            <input type="number" id="answerNum" placeholder="分子" min="-100" max="100" style="width: 100px;">
                            <hr style="width: 100px;">
                            <input type="number" id="answerDen" placeholder="分母" min="1" max="100" style="width: 100px;">
                        </div>
                    </div>
                    
                    <!-- 添加统一的提交按钮 -->
                    <div class="submit-btn-container" id="submitBtnContainer" style="display: none;">
                        <button id="submitAnswer">提交答案</button>
                    </div>
                </div>
                
                <div class="feedback" id="practiceFeedback"></div>
                
                <div class="step-by-step" id="practiceSolution" style="display: none;"></div>
            </div>
        </div>
        
        <!-- 动画演示区域 -->
        <div id="animation" class="tab-content">
            <h2 class="section-title">分数运算动画演示</h2>
            <p>通过动画直观地理解分数加减乘除的运算过程。</p>
            
            <div class="controls">
                <div class="input-group">
                    <label for="animNum1">分子1:</label>
                    <input type="number" id="animNum1" min="0" max="20" value="3">
                </div>
                <div class="input-group">
                    <label for="animDen1">分母1:</label>
                    <input type="number" id="animDen1" min="1" max="20" value="4">
                </div>
                <div class="input-group">
                    <label for="animationType">运算类型:</label>
                    <select id="animationType">
                        <option value="addition">分数加法</option>
                        <option value="subtraction">分数减法</option>
                        <option value="multiplication">分数乘法</option>
                        <option value="division">分数除法</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="animNum2">分子2:</label>
                    <input type="number" id="animNum2" min="0" max="20" value="1">
                </div>
                <div class="input-group">
                    <label for="animDen2">分母2:</label>
                    <input type="number" id="animDen2" min="1" max="20" value="2">
                </div>
                <button id="startAnimation">开始动画</button>
                <button id="helpAnimation" class="help-btn">帮助</button>
            </div>
            
            <div class="animation-container">
                <div class="animation-controls">
                    <button id="playAnimation">播放</button>
                    <button id="pauseAnimation" disabled>暂停</button>
                    <button id="resetAnimation">重置</button>
                    <button id="nextStep" disabled>下一步</button>
                </div>
                
                <div class="animation-progress-container">
                    <div class="progress" id="animationProgress"></div>
                </div>
                
                <div class="animation-stage" id="animationStage">
                    <div class="fraction-display">
                        <div class="fraction" id="animFraction1">
                            <span class="numerator">3</span>
                            <span class="denominator">4</span>
                        </div>
                        <div class="operation-symbol" id="animOperationSymbol">+</div>
                        <div class="fraction" id="animFraction2">
                            <span class="numerator">1</span>
                            <span class="denominator">2</span>
                        </div>
                        <div class="equals-symbol">=</div>
                        <div class="fraction" id="animResultFraction">
                            <span class="numerator">?</span>
                            <span class="denominator">?</span>
                        </div>
                    </div>
                    
                    <!-- 转换后的分数显示区域 -->
                    <div id="convertedFractions" style="text-align: center; margin: 20px 0; display: none;">
                        <div>转换为相同分母:</div>
                        <div id="convertedFraction1" class="converted-fraction"></div>
                        <div class="operation-symbol" id="convertedOperationSymbol">+</div>
                        <div id="convertedFraction2" class="converted-fraction"></div>
                        <div class="equals-symbol">=</div>
                        <div id="convertedResult" class="converted-fraction">?</div>
                    </div>
                    
                    <div class="visualization-area">
                        <div>
                            <div class="visual-fraction" id="animVisualFraction1"></div>
                            <div style="text-align: center; margin-top: 10px;">分数1</div>
                        </div>
                        <div>
                            <div class="visual-fraction" id="animVisualFraction2"></div>
                            <div style="text-align: center; margin-top: 10px;">分数2</div>
                        </div>
                        <div>
                            <div class="visual-fraction" id="animVisualResult"></div>
                            <div style="text-align: center; margin-top: 10px;">结果</div>
                        </div>
                    </div>
                    
                    <div class="step-description" id="animStepDescription">
                        点击"开始动画"按钮开始演示
                    </div>
                </div>
                
                <div class="step-indicator" id="animStepIndicator">
                    <!-- 步骤指示器将通过JS动态生成 -->
                </div>
            </div>
        </div>
        
        <!-- 错题本 -->
        <div id="mistakes" class="tab-content">
            <h2 class="section-title">我的错题本</h2>
            <p>这里记录了你练习中答错的题目，点击题目可以查看详细解析。</p>
            
            <div id="mistakesList" style="margin-top: 20px;">
                <!-- 错题列表将通过JS动态生成 -->
                <div style="text-align: center; padding: 20px; color: #666;" id="emptyMistakes">
                    暂无错题记录，开始练习吧！
                </div>
            </div>
            
            <div class="controls">
                <button id="clearMistakes" style="background-color: var(--danger);">清空错题本</button>
                <button id="helpMistakes" class="help-btn">帮助</button>
            </div>
        </div>
        
        <!-- 学习统计 -->
        <div id="stats" class="tab-content">
            <h2 class="section-title">我的学习统计</h2>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="totalQuestions">0</div>
                    <div>总答题数</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalCorrect">0</div>
                    <div>正确题数</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalIncorrect">0</div>
                    <div>错误题数</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="accuracyRate">0%</div>
                    <div>正确率</div>
                </div>
            </div>
            
            <h3 style="margin: 20px 0; color: var(--primary);">各类型题目答题情况</h3>
            <div id="statsByType" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <!-- 各类型统计将通过JS动态生成 -->
                <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #666;">
                    暂无答题数据，开始练习吧！
                </div>
            </div>
            
            <div class="controls">
                <button id="resetStats" style="background-color: #6c757d;">重置统计数据</button>
                <button id="helpStats" class="help-btn">帮助</button>
            </div>
        </div>
    </div>

    <!-- 帮助模态框 -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <h3 id="helpTitle">使用帮助</h3>
            <div id="helpContent"></div>
            <button id="closeHelp" class="modal-close">关闭</button>
        </div>
    </div>

    <script>
        // 基础功能代码（原有代码保持不变，这里只展示新增功能）
        // ... 原有代码保持不变 ...
        
        // ==================== 新增功能：分数转换（带分数与假分数互转） ====================
        // 切换转换类型
        document.getElementById('convertType').addEventListener('change', function() {
            if (this.value === 'improper-to-mixed') {
                document.getElementById('improperToMixed').style.display = 'block';
                document.getElementById('mixedToImproper').style.display = 'none';
            } else {
                document.getElementById('improperToMixed').style.display = 'none';
                document.getElementById('mixedToImproper').style.display = 'block';
            }
            document.getElementById('convertResult').innerHTML = '转换结果将显示在这里';
            document.getElementById('convertResult').className = 'result';
            document.getElementById('convertSteps').innerHTML = '';
        });

        // 假分数转带分数
        document.getElementById('convertImproperBtn').addEventListener('click', function() {
            const num = parseInt(document.getElementById('impNum').value);
            const den = parseInt(document.getElementById('impDen').value);
            
            if (isNaN(num) || isNaN(den) || den === 0) {
                document.getElementById('convertResult').innerHTML = '<span style="color: var(--danger);">请输入有效的分数（分母不能为0）</span>';
                document.getElementById('convertResult').className = 'result incorrect';
                document.getElementById('convertSteps').innerHTML = '';
                return;
            }
            
            if (num <= den) {
                document.getElementById('convertResult').innerHTML = '<span style="color: var(--danger);">假分数的分子必须大于分母</span>';
                document.getElementById('convertResult').className = 'result incorrect';
                document.getElementById('convertSteps').innerHTML = '';
                return;
            }
            
            // 计算带分数
            const whole = Math.floor(num / den);
            const remainder = num % den;
            
            let resultHTML = `转换结果: ${whole}<span class="fraction"><span class="numerator">${remainder}</span><span class="denominator">${den}</span></span>`;
            if (remainder === 0) {
                resultHTML = `转换结果: ${whole} (分数部分为0)`;
            }
            
            document.getElementById('convertResult').innerHTML = resultHTML;
            document.getElementById('convertResult').className = 'result correct';
            
            // 显示步骤
            const stepsDiv = document.getElementById('convertSteps');
            stepsDiv.innerHTML = '<h3>转换步骤:</h3>';
            stepsDiv.innerHTML += `<div class="step">步骤1: 用分子除以分母: ${num} ÷ ${den} = ${whole} 余 ${remainder}</div>`;
            stepsDiv.innerHTML += `<div class="step">步骤2: 商作为整数部分: ${whole}</div>`;
            if (remainder > 0) {
                stepsDiv.innerHTML += `<div class="step">步骤3: 余数作为新分子，分母保持不变: ${remainder}/${den}</div>`;
                stepsDiv.innerHTML += `<div class="step">步骤4: 组合成带分数: ${whole} ${remainder}/${den}</div>`;
            } else {
                stepsDiv.innerHTML += `<div class="step">步骤3: 余数为0，所以结果就是整数 ${whole}</div>`;
            }
        });

        // 带分数转假分数
        document.getElementById('convertMixedBtn').addEventListener('click', function() {
            const whole = parseInt(document.getElementById('mixedWhole').value);
            const num = parseInt(document.getElementById('mixedNum').value);
            const den = parseInt(document.getElementById('mixedDen').value);
            
            if (isNaN(whole) || isNaN(num) || isNaN(den) || den === 0) {
                document.getElementById('convertResult').innerHTML = '<span style="color: var(--danger);">请输入有效的带分数（分母不能为0）</span>';
                document.getElementById('convertResult').className = 'result incorrect';
                document.getElementById('convertSteps').innerHTML = '';
                return;
            }
            
            if (whole < 0) {
                document.getElementById('convertResult').innerHTML = '<span style="color: var(--danger);">带分数的整数部分必须大于等于0</span>';
                document.getElementById('convertResult').className = 'result incorrect';
                document.getElementById('convertSteps').innerHTML = '';
                return;
            }
            
            if (num >= den) {
                document.getElementById('convertResult').innerHTML = '<span style="color: var(--danger);">带分数的分子必须小于分母</span>';
                document.getElementById('convertResult').className = 'result incorrect';
                document.getElementById('convertSteps').innerHTML = '';
                return;
            }
            
            // 计算假分数
            const improperNum = whole * den + num;
            
            document.getElementById('convertResult').innerHTML = 
                `转换结果: <span class="fraction"><span class="numerator">${improperNum}</span><span class="denominator">${den}</span></span>`;
            document.getElementById('convertResult').className = 'result correct';
            
            // 显示步骤
            const stepsDiv = document.getElementById('convertSteps');
            stepsDiv.innerHTML = '<h3>转换步骤:</h3>';
            stepsDiv.innerHTML += `<div class="step">步骤1: 整数部分乘分母: ${whole} × ${den} = ${whole * den}</div>`;
            stepsDiv.innerHTML += `<div class="step">步骤2: 加上分子: ${whole * den} + ${num} = ${improperNum}</div>`;
            stepsDiv.innerHTML += `<div class="step">步骤3: 结果作为新分子，分母保持不变: ${improperNum}/${den}</div>`;
        });

        // ==================== 新增功能：分数小数互转 ====================
        document.getElementById('decimalConvertType').addEventListener('change', function() {
            if (this.value === 'fraction-to-decimal') {
                document.getElementById('fractionToDecimal').style.display = 'block';
                document.getElementById('decimalToFraction').style.display = 'none';
            } else {
                document.getElementById('fractionToDecimal').style.display = 'none';
                document.getElementById('decimalToFraction').style.display = 'block';
            }
            document.getElementById('decimalConvertResult').innerHTML = '转换结果将显示在这里';
            document.getElementById('decimalConvertResult').className = 'result';
            document.getElementById('decimalConvertSteps').innerHTML = '';
        });

        // 分数转小数
        document.getElementById('convertFractionToDecimalBtn').addEventListener('click', function() {
            const num = parseInt(document.getElementById('fracDecNum').value);
            const den = parseInt(document.getElementById('fracDecDen').value);
            
            if (isNaN(num) || isNaN(den) || den === 0) {
                document.getElementById('decimalConvertResult').innerHTML = '<span style="color: var(--danger);">请输入有效的分数（分母不能为0）</span>';
                document.getElementById('decimalConvertResult').className = 'result incorrect';
                document.getElementById('decimalConvertSteps').innerHTML = '';
                return;
            }
            
            const decimal = (num / den).toFixed(4);
            
            document.getElementById('decimalConvertResult').innerHTML = 
                `转换结果: ${num}/${den} = ${decimal}`;
            document.getElementById('decimalConvertResult').className = 'result correct';
            
            // 显示步骤
            const stepsDiv = document.getElementById('decimalConvertSteps');
            stepsDiv.innerHTML = '<h3>转换步骤:</h3>';
            stepsDiv.innerHTML += `<div class="step">步骤1: 用分子除以分母: ${num} ÷ ${den} = ${decimal}</div>`;
            
            // 检查是否是循环小数
            if (den % 2 !== 0 && den % 5 !== 0 && den !== 1) {
                stepsDiv.innerHTML += `<div class="step">注意: 这是一个循环小数，结果保留4位小数</div>`;
            }
        });

        // 小数转分数
        document.getElementById('convertDecimalToFractionBtn').addEventListener('click', function() {
            let decimal = parseFloat(document.getElementById('decimalNum').value);
            
            if (isNaN(decimal)) {
                document.getElementById('decimalConvertResult').innerHTML = '<span style="color: var(--danger);">请输入有效的小数</span>';
                document.getElementById('decimalConvertResult').className = 'result incorrect';
                document.getElementById('decimalConvertSteps').innerHTML = '';
                return;
            }
            
            // 处理负数
            let negative = false;
            if (decimal < 0) {
                negative = true;
                decimal = -decimal;
            }
            
            // 转换小数为分数
            let denominator = 1;
            const decimalStr = decimal.toString();
            const decimalPlaces = decimalStr.includes('.') ? decimalStr.split('.')[1].length : 0;
            denominator = Math.pow(10, decimalPlaces);
            let numerator = decimal * denominator;
            
            // 简化分数
            const gcdValue = gcd(numerator, denominator);
            numerator /= gcdValue;
            denominator /= gcdValue;
            
            // 处理负号
            if (negative) {
                numerator = -numerator;
            }
            
            document.getElementById('decimalConvertResult').innerHTML = 
                `转换结果: ${decimal} = <span class="fraction"><span class="numerator">${numerator}</span><span class="denominator">${denominator}</span></span>`;
            document.getElementById('decimalConvertResult').className = 'result correct';
            
            // 显示步骤
            const stepsDiv = document.getElementById('decimalConvertSteps');
            stepsDiv.innerHTML = '<h3>转换步骤:</h3>';
            stepsDiv.innerHTML += `<div class="step">步骤1: 将小数乘以10的${decimalPlaces}次方: ${decimal} × ${denominator} = ${decimal * denominator}</div>`;
            stepsDiv.innerHTML += `<div class="step">步骤2: 得到分数: ${decimal * denominator}/${denominator}</div>`;
            stepsDiv.innerHTML += `<div class="step">步骤3: 找到分子和分母的最大公约数: GCD(${decimal * denominator}, ${denominator}) = ${gcdValue}</div>`;
            stepsDiv.innerHTML += `<div class="step">步骤4: 简化分数: ${decimal * denominator}/${denominator} = ${numerator}/${denominator}</div>`;
        });

        // ==================== 新增功能：帮助系统 ====================
        // 帮助模态框功能
        document.getElementById('closeHelp').addEventListener('click', function() {
            document.getElementById('helpModal').style.display = 'none';
        });

        // 为每个帮助按钮添加点击事件
        const helpContent = {
            intro: {
                title: '分数介绍帮助',
                content: `
                    <p>分数介绍部分为你提供分数的基础知识：</p>
                    <ul>
                        <li><strong>分子</strong>：表示被选取的部分数量</li>
                        <li><strong>分母</strong>：表示整体被分成的总份数</li>
                        <li><strong>真分数</strong>：分子小于分母的分数</li>
                        <li><strong>假分数</strong>：分子大于或等于分母的分数</li>
                        <li><strong>带分数</strong>：由整数和真分数组成的分数</li>
                        <li><strong>等价分数</strong>：不同的分数表示相同的值</li>
                    </ul>
                    <p><strong>学习建议：</strong></p>
                    <ol>
                        <li>理解分子和分母的基本含义</li>
                        <li>区分不同类型的分数</li>
                        <li>掌握等价分数的概念</li>
                    </ol>
                `
            },
            visualize: {
                title: '分数可视化帮助',
                content: `
                    <p>分数可视化工具可以帮助你直观地理解分数的含义：</p>
                    <ul>
                        <li><strong>分子</strong>：表示选中的部分数量</li>
                        <li><strong>分母</strong>：表示整体被分成的总份数</li>
                        <li><strong>圆形视图</strong>：将圆分成若干等份，显示选中的部分</li>
                        <li><strong>矩形视图</strong>：将矩形分成若干等份，显示选中的部分</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>输入分子和分母的值</li>
                        <li>选择可视化类型（圆形或矩形）</li>
                        <li>点击"更新可视化"按钮查看效果</li>
                    </ol>
                `
            },
            compare: {
                title: '比较分数帮助',
                content: `
                    <p>比较分数工具可以帮助你判断两个分数的大小关系：</p>
                    <ul>
                        <li>输入两个分数的分子和分母</li>
                        <li>点击"比较"按钮查看结果</li>
                        <li>工具会自动显示两个分数的可视化效果</li>
                    </ul>
                    <p><strong>比较方法：</strong></p>
                    <ol>
                        <li>找到两个分数的公分母</li>
                        <li>将两个分数转换为相同分母</li>
                        <li>比较分子的大小</li>
                        <li>分子大的分数更大</li>
                    </ol>
                `
            },
            operations: {
                title: '分数运算帮助',
                content: `
                    <p>分数运算工具可以帮助你练习分数的加、减、乘、除运算：</p>
                    <ul>
                        <li><strong>加法</strong>：找到公分母，分子相加</li>
                        <li><strong>减法</strong>：找到公分母，分子相减</li>
                        <li><strong>乘法</strong>：分子乘分子，分母乘分母</li>
                        <li><strong>除法</strong>：乘以倒数，再按乘法计算</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>选择运算类型（+、-、×、÷）</li>
                        <li>输入两个分数的值</li>
                        <li>输入你的答案（分子和分母）</li>
                        <li>点击"检查答案"查看是否正确</li>
                        <li>点击"计算"按钮可以自动计算正确答案</li>
                    </ol>
                `
            },
            simplify: {
                title: '分数简化帮助',
                content: `
                    <p>分数简化工具可以将分数化简到最简形式：</p>
                    <ul>
                        <li><strong>最简分数</strong>：分子和分母只有公约数1的分数</li>
                        <li><strong>最大公约数(GCD)</strong>：分子和分母的最大公因数</li>
                        <li><strong>简化步骤</strong>：分子和分母都除以它们的最大公约数</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>输入分数的分子和分母</li>
                        <li>点击"简化分数"按钮</li>
                        <li>查看简化结果和详细步骤</li>
                    </ol>
                `
            },
            convert: {
                title: '分数转换帮助',
                content: `
                    <p>分数转换工具可以在带分数和假分数之间进行转换：</p>
                    <ul>
                        <li><strong>假分数转带分数</strong>：用分子除以分母，商是整数部分，余数是新分子</li>
                        <li><strong>带分数转假分数</strong>：整数部分乘以分母，再加上分子，得到新分子</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>选择转换类型（假分数→带分数 或 带分数→假分数）</li>
                        <li>输入相应的分数值</li>
                        <li>点击转换按钮查看结果</li>
                        <li>查看详细的转换步骤</li>
                    </ol>
                `
            },
            decimal: {
                title: '分数小数互转帮助',
                content: `
                    <p>分数小数互转工具可以在分数和小数之间进行转换：</p>
                    <ul>
                        <li><strong>分数转小数</strong>：用分子除以分母</li>
                        <li><strong>小数转分数</strong>：将小数写成分数形式，然后简化</li>
                        <li><strong>循环小数</strong>：分母只包含质因数2和5的小数可以转换为有限小数</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>选择转换类型（分数→小数 或 小数→分数）</li>
                        <li>输入相应的数值</li>
                        <li>点击转换按钮查看结果</li>
                        <li>查看详细的转换步骤</li>
                    </ol>
                `
            },
            practice: {
                title: '练习帮助',
                content: `
                    <p>练习功能可以帮助你巩固分数知识：</p>
                    <ul>
                        <li><strong>题目类型</strong>：选择要练习的分数知识点</li>
                        <li><strong>难度级别</strong>：简单、中等、困难三种难度</li>
                        <li><strong>答题方式</strong>：选择题或输入题</li>
                        <li><strong>即时反馈</strong>：提交后立即知道是否正确</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>选择题目类型和难度</li>
                        <li>点击"开始练习"按钮</li>
                        <li>回答问题并提交答案</li>
                        <li>查看反馈和解析</li>
                        <li>点击"下一题"继续练习</li>
                    </ol>
                `
            },
            animation: {
                title: '动画演示帮助',
                content: `
                    <p>动画演示工具可以直观展示分数运算的步骤：</p>
                    <ul>
                        <li><strong>运算类型</strong>：选择要演示的运算（加、减、乘、除）</li>
                        <li><strong>可视化展示</strong>：每个步骤都有对应的可视化效果</li>
                        <li><strong>分步控制</strong>：可以播放、暂停、重置、下一步</li>
                        <li><strong>进度显示</strong>：显示当前步骤和总步骤</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>输入两个分数的值</li>
                        <li>选择运算类型</li>
                        <li>点击"开始动画"按钮</li>
                        <li>使用播放控制按钮控制动画</li>
                        <li>查看每一步的详细说明</li>
                    </ol>
                `
            },
            mistakes: {
                title: '错题本帮助',
                content: `
                    <p>错题本记录了你练习中答错的题目，方便复习：</p>
                    <ul>
                        <li><strong>自动记录</strong>：练习中答错的题目会自动保存</li>
                        <li><strong>详细查看</strong>：点击"查看解析"可以查看题目详细解析</li>
                        <li><strong>时间记录</strong>：每道错题都有时间戳</li>
                        <li><strong>复习功能</strong>：可以反复查看错题和解析</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>在练习中答错的题目会自动保存到这里</li>
                        <li>点击"查看解析"查看题目的详细解答</li>
                        <li>点击"清空错题本"可以删除所有错题记录</li>
                        <li>定期复习错题可以帮助你避免重复错误</li>
                    </ol>
                `
            },
            stats: {
                title: '学习统计帮助',
                content: `
                    <p>学习统计展示你的学习进度和成绩：</p>
                    <ul>
                        <li><strong>总体统计</strong>：总答题数、正确数、错误数、正确率</li>
                        <li><strong>分类统计</strong>：各类型题目的答题情况</li>
                        <li><strong>进度追踪</strong>：记录你的学习进步</li>
                        <li><strong>激励功能</strong>：通过数据激励你继续学习</li>
                    </ul>
                    <p><strong>使用方法：</strong></p>
                    <ol>
                        <li>每次练习都会自动更新统计数据</li>
                        <li>查看总体学习情况</li>
                        <li>分析自己在不同类型题目上的表现</li>
                        <li>点击"重置统计数据"可以清空所有统计</li>
                    </ol>
                `
            }
        };

        // 为每个帮助按钮绑定事件
        document.querySelectorAll('[id^="help"]').forEach(button => {
            button.addEventListener('click', function() {
                const helpId = this.id.replace('help', '').toLowerCase();
                if (helpContent[helpId]) {
                    document.getElementById('helpTitle').textContent = helpContent[helpId].title;
                    document.getElementById('helpContent').innerHTML = helpContent[helpId].content;
                    document.getElementById('helpModal').style.display = 'flex';
                }
            });
        });

        // ==================== 新增功能：错题本 ====================
        // 修改checkPracticeAnswer函数，添加错题记录
        const originalCheckPracticeAnswer = checkPracticeAnswer;
        function checkPracticeAnswer() {
            const question = practiceStats.currentQuestion;
            if (!question || practiceStats.submitted) {
                return;
            }
            
            let userAnswer, isCorrect;
            
            if (question.type === 'comparison') {
                const selectedOption = document.querySelector('.option.selected');
                if (!selectedOption) {
                    alert('请选择一个答案');
                    return;
                }
                userAnswer = selectedOption.textContent;
                isCorrect = userAnswer === question.correctAnswer;
            } else {
                const userNum = parseInt(document.getElementById('answerNum').value);
                const userDen = parseInt(document.getElementById('answerDen').value);
                
                if (isNaN(userNum) || isNaN(userDen) || userDen === 0) {
                    alert('请输入有效的分数（分母不能为0）');
                    return;
                }
                
                // 简化用户答案
                const absUserNum = Math.abs(userNum);
                const userGcd = gcd(absUserNum, userDen);
                const simplifiedUserNum = userNum / userGcd;
                const simplifiedUserDen = userDen / userGcd;
                
                userAnswer = { numerator: simplifiedUserNum, denominator: simplifiedUserDen };
                
                // 正确处理减法的负数答案
                isCorrect = simplifiedUserNum === question.correctAnswer.numerator && 
                           simplifiedUserDen === question.correctAnswer.denominator;
            }
            
            // 标记为已提交
            practiceStats.submitted = true;
            
            // 更新统计信息
            practiceStats.total++;
            if (isCorrect) {
                practiceStats.correct++;
                practiceStats.score += 10;
                document.getElementById('practiceFeedback').textContent = '正确！做得很好！';
                document.getElementById('practiceFeedback').className = 'feedback correct';
            } else {
                practiceStats.incorrect++;
                document.getElementById('practiceFeedback').textContent = '不正确。请查看下面的解析。';
                document.getElementById('practiceFeedback').className = 'feedback incorrect';
                
                // 记录错题
                saveMistake(question, userAnswer);
            }
            
            updatePracticeStats();
            updateProgressBar();
            
            // 启用下一题按钮
            document.getElementById('nextQuestion').disabled = false;
            
            // 显示反馈和解析
            document.getElementById('practiceFeedback').style.display = 'block';
            
            // 构建解析信息
            let solutionHTML = `<h3>解析:</h3><p>${question.explanation}</p>`;
            
            // 对于运算题，显示正确答案
            if (question.type === 'operation' || question.type === 'simplification') {
                solutionHTML += `<p><strong>正确答案: </strong>`;
                
                if (question.resultDisplay) {
                    solutionHTML += question.resultDisplay;
                } else {
                    solutionHTML += `${question.correctAnswer.numerator}/${question.correctAnswer.denominator}`;
                    
                    // 如果是假分数，显示带分数形式
                    if (question.correctAnswer.numerator > question.correctAnswer.denominator) {
                        const wholePart = Math.floor(question.correctAnswer.numerator / question.correctAnswer.denominator);
                        const remainder = question.correctAnswer.numerator % question.correctAnswer.denominator;
                        if (remainder !== 0) {
                            solutionHTML += ` 或 ${wholePart} ${remainder}/${question.correctAnswer.denominator}`;
                        } else {
                            solutionHTML += ` 或 ${wholePart}`;
                        }
                    }
                }
                solutionHTML += `</p>`;
            }
            
            document.getElementById('practiceSolution').innerHTML = solutionHTML;
            document.getElementById('practiceSolution').style.display = 'block';
            
            // 如果是选择题，标记正确和错误答案
            if (question.type === 'comparison') {
                document.querySelectorAll('.option').forEach(option => {
                    if (option.textContent === question.correctAnswer) {
                        option.classList.add('correct-answer');
                    } else if (option.classList.contains('selected') && option.textContent !== question.correctAnswer) {
                        option.classList.add('wrong-answer');
                    }
                });
            }
            
            // 更新学习统计
            saveAnswerStats(question.type, isCorrect);
            
            // 保存练习进度
            savePracticeStats();
        }

        // 保存错题
        function saveMistake(question, userAnswer) {
            let mistakes = JSON.parse(localStorage.getItem('fractionMistakes') || '[]');
            
            const mistake = {
                id: Date.now(),
                question: {
                    type: question.type,
                    question: question.question,
                    correctAnswer: question.correctAnswer,
                    explanation: question.explanation,
                    resultDisplay: question.resultDisplay || null
                },
                userAnswer: userAnswer,
                timestamp: new Date().toLocaleString('zh-CN')
            };
            
            mistakes.push(mistake);
            localStorage.setItem('fractionMistakes', JSON.stringify(mistakes));
            
            // 更新错题本显示
            if (document.querySelector('.tab[data-tab="mistakes"]').classList.contains('active')) {
                loadMistakes();
            }
        }

        // 加载错题
        function loadMistakes() {
            const mistakes = JSON.parse(localStorage.getItem('fractionMistakes') || '[]');
            const mistakesList = document.getElementById('mistakesList');
            
            if (mistakes.length === 0) {
                document.getElementById('emptyMistakes').style.display = 'block';
                mistakesList.innerHTML = '';
                return;
            }
            
            document.getElementById('emptyMistakes').style.display = 'none';
            mistakesList.innerHTML = '';
            
            mistakes.forEach(mistake => {
                const mistakeItem = document.createElement('div');
                mistakeItem.className = 'mistake-item';
                mistakeItem.style.marginBottom = '20px';
                
                const userAnswerStr = formatAnswer(mistake.userAnswer);
                const correctAnswerStr = formatAnswer(mistake.question.correctAnswer);
                
                mistakeItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div class="question-text" style="font-size: 1.1rem;">${mistake.question.question}</div>
                        <small style="color: #666;">${mistake.timestamp}</small>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>你的答案：</strong> <span style="color: var(--danger);">${userAnswerStr}</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>正确答案：</strong> <span style="color: var(--success);">${correctAnswerStr}</span>
                    </div>
                    <button class="viewMistakeDetail" data-id="${mistake.id}" style="background-color: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: var(--border-radius); cursor: pointer;">查看解析</button>
                    <div class="step-by-step" style="display: none; margin-top: 10px;" id="detail-${mistake.id}">
                        <h4>解析:</h4>
                        <p>${mistake.question.explanation}</p>
                    </div>
                `;
                
                mistakesList.appendChild(mistakeItem);
            });
            
            // 绑定查看解析事件
            document.querySelectorAll('.viewMistakeDetail').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const detailDiv = document.getElementById(`detail-${id}`);
                    
                    if (detailDiv.style.display === 'none') {
                        detailDiv.style.display = 'block';
                        this.textContent = '隐藏解析';
                    } else {
                        detailDiv.style.display = 'none';
                        this.textContent = '查看解析';
                    }
                });
            });
        }

        // 格式化答案显示
        function formatAnswer(answer) {
            if (typeof answer === 'string') {
                return answer;
            } else if (answer.numerator !== undefined && answer.denominator !== undefined) {
                return `<span class="fraction"><span class="numerator">${answer.numerator}</span><span class="denominator">${answer.denominator}</span></span>`;
            }
            return '无';
        }

        // 清空错题本
        document.getElementById('clearMistakes').addEventListener('click', function() {
            if (confirm('确定要清空错题本吗？此操作不可恢复！')) {
                localStorage.removeItem('fractionMistakes');
                loadMistakes();
            }
        });

        // ==================== 新增功能：学习统计 ====================
        // 保存答题统计
        function saveAnswerStats(type, isCorrect) {
            let stats = JSON.parse(localStorage.getItem('fractionLearningStats') || '{"total":0,"correct":0,"incorrect":0,"types":{}}');
            
            stats.total++;
            if (isCorrect) {
                stats.correct++;
            } else {
                stats.incorrect++;
            }
            
            // 按类型统计
            if (!stats.types[type]) {
                stats.types[type] = { total: 0, correct: 0, incorrect: 0 };
            }
            stats.types[type].total++;
            if (isCorrect) {
                stats.types[type].correct++;
            } else {
                stats.types[type].incorrect++;
            }
            
            localStorage.setItem('fractionLearningStats', JSON.stringify(stats));
            
            // 如果当前在统计页面，更新显示
            if (document.querySelector('.tab[data-tab="stats"]').classList.contains('active')) {
                loadLearningStats();
            }
        }

        // 加载学习统计
        function loadLearningStats() {
            const stats = JSON.parse(localStorage.getItem('fractionLearningStats') || '{"total":0,"correct":0,"incorrect":0,"types":{}}');
            
            // 更新总体统计
            document.getElementById('totalQuestions').textContent = stats.total;
            document.getElementById('totalCorrect').textContent = stats.correct;
            document.getElementById('totalIncorrect').textContent = stats.incorrect;
            
            // 计算正确率
            const accuracy = stats.total > 0 ? ((stats.correct / stats.total) * 100).toFixed(1) : 0;
            document.getElementById('accuracyRate').textContent = `${accuracy}%`;
            
            // 更新各类型统计
            const statsByType = document.getElementById('statsByType');
            statsByType.innerHTML = '';
            
            const typeNames = {
                'comparison': '比较分数',
                'simplification': '分数简化',
                'operation': '分数运算',
                'addition': '分数加法',
                'subtraction': '分数减法',
                'multiplication': '分数乘法',
                'division': '分数除法'
            };
            
            let hasData = false;
            for (const [type, data] of Object.entries(stats.types)) {
                if (data.total > 0) {
                    hasData = true;
                    const typeAccuracy = data.total > 0 ? ((data.correct / data.total) * 100).toFixed(1) : 0;
                    
                    const typeStat = document.createElement('div');
                    typeStat.className = 'type-stat';
                    typeStat.innerHTML = `
                        <h4>${typeNames[type] || type}</h4>
                        <div>总题数: ${data.total}</div>
                        <div>正确: ${data.correct}</div>
                        <div>错误: ${data.incorrect}</div>
                        <div style="font-weight: bold; color: var(--primary); margin-top: 5px;">正确率: ${typeAccuracy}%</div>
                    `;
                    
                    statsByType.appendChild(typeStat);
                }
            }
            
            // 如果没有数据，显示提示
            if (!hasData) {
                statsByType.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #666;">
                        暂无答题数据，开始练习吧！
                    </div>
                `;
            }
        }

        // 重置统计数据
        document.getElementById('resetStats').addEventListener('click', function() {
            if (confirm('确定要重置所有学习统计数据吗？此操作不可恢复！')) {
                localStorage.removeItem('fractionLearningStats');
                loadLearningStats();
            }
        });

        // ==================== 新增功能：进度保存 ====================
        function savePracticeStats() {
            // 不保存currentQuestion，因为它可能包含函数
            const statsToSave = {
                score: practiceStats.score,
                correct: practiceStats.correct,
                incorrect: practiceStats.incorrect,
                total: practiceStats.total,
                isPracticeActive: practiceStats.isPracticeActive,
                submitted: practiceStats.submitted,
                practiceType: document.getElementById('practiceType').value,
                difficulty: document.getElementById('difficulty').value
            };
            
            localStorage.setItem('fractionPracticeStats', JSON.stringify(statsToSave));
        }

        function loadPracticeStats() {
            const saved = localStorage.getItem('fractionPracticeStats');
            if (saved) {
                const savedStats = JSON.parse(saved);
                
                // 恢复统计数字
                practiceStats.score = savedStats.score || 0;
                practiceStats.correct = savedStats.correct || 0;
                practiceStats.incorrect = savedStats.incorrect || 0;
                practiceStats.total = savedStats.total || 0;
                practiceStats.isPracticeActive = savedStats.isPracticeActive || false;
                practiceStats.submitted = savedStats.submitted || false;
                
                updatePracticeStats();
                updateProgressBar();
                
                // 恢复练习类型和难度
                if (savedStats.practiceType) {
                    document.getElementById('practiceType').value = savedStats.practiceType;
                }
                if (savedStats.difficulty) {
                    document.getElementById('difficulty').value = savedStats.difficulty;
                }
                
                // 如果有正在进行的练习，显示练习容器
                if (practiceStats.isPracticeActive) {
                    document.getElementById('practiceContainer').style.display = 'block';
                    document.getElementById('nextQuestion').style.display = 'inline-block';
                    document.getElementById('nextQuestion').disabled = !practiceStats.submitted;
                    
                    // 如果没有当前题目，生成一个新的
                    if (!practiceStats.currentQuestion) {
                        generatePracticeQuestion();
                    }
                }
            }
        }

        // 修改resetPracticeStats函数
        function resetPracticeStats() {
            practiceStats = {
                score: 0,
                correct: 0,
                incorrect: 0,
                total: 0,
                currentQuestion: null,
                isPracticeActive: false,
                submitted: false
            };
            
            localStorage.removeItem('fractionPracticeStats'); // 清除保存的进度
            
            updatePracticeStats();
            updateProgressBar();
            
            // 隐藏练习容器
            document.getElementById('practiceContainer').style.display = 'none';
            document.getElementById('nextQuestion').style.display = 'none';
            document.getElementById('practiceFeedback').style.display = 'none';
            document.getElementById('practiceSolution').style.display = 'none';
            document.getElementById('nextQuestion').disabled = false;
        }

        // 修改updatePracticeStats函数
        function updatePracticeStats() {
            document.getElementById('score').textContent = practiceStats.score;
            document.getElementById('correctCount').textContent = practiceStats.correct;
            document.getElementById('incorrectCount').textContent = practiceStats.incorrect;
            document.getElementById('questionCount').textContent = practiceStats.total;
            
            // 保存进度
            if (practiceStats.isPracticeActive) {
                savePracticeStats();
            }
        }

        // ==================== 修改标签切换事件 ====================
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // 初始化当前标签的内容
                if (tabId === 'visualize') {
                    updateVisualization();
                } else if (tabId === 'compare') {
                    updateComparisonVisualization();
                } else if (tabId === 'operations') {
                    setupOperationProblem();
                } else if (tabId === 'practice') {
                    // 不再重置，而是加载保存的进度
                    if (!practiceStats.isPracticeActive) {
                        resetPracticeStats();
                    }
                } else if (tabId === 'animation') {
                    resetAnimation();
                } else if (tabId === 'convert') {
                    // 初始化转换类型切换
                    document.getElementById('convertType').dispatchEvent(new Event('change'));
                } else if (tabId === 'decimal') {
                    // 初始化分数小数转换类型切换
                    document.getElementById('decimalConvertType').dispatchEvent(new Event('change'));
                } else if (tabId === 'mistakes') {
                    loadMistakes();
                } else if (tabId === 'stats') {
                    loadLearningStats();
                }
            });
        });

        // ==================== 页面加载时初始化 ====================
        window.addEventListener('load', function() {
            // 加载保存的练习进度
            loadPracticeStats();
            
            // 加载其他初始化
            updateVisualization();
            updateComparisonVisualization();
            setupOperationProblem();
            
            // 初始化转换功能
            document.getElementById('convertType').dispatchEvent(new Event('change'));
            document.getElementById('decimalConvertType').dispatchEvent(new Event('change'));
            
            // 初始化最大公约数函数（如果尚未定义）
            if (typeof gcd === 'undefined') {
                function gcd(a, b) {
                    a = Math.abs(a);
                    b = Math.abs(b);
                    return b === 0 ? a : gcd(b, a % b);
                }
            }
            
            console.log('分数学习助手已加载完成！');
        });

        // 原有基础功能代码（需要确保以下函数已定义）：
        // updateVisualization, updateComparisonVisualization, setupOperationProblem, 
        // generatePracticeQuestion, displayPracticeQuestion, resetAnimation等
        
        // 如果这些函数未定义，需要从原有代码中复制过来
        
        // ==================== 基础功能（简化版，确保核心功能运行） ====================
        // 这里只包含必要的基础函数，完整版应包含原有所有功能
        
        // 分数可视化功能
        function updateVisualization() {
            const numerator = parseInt(document.getElementById('visNumerator').value);
            const denominator = parseInt(document.getElementById('visDenominator').value);
            const type = document.getElementById('visType').value;
            
            if (isNaN(numerator) || isNaN(denominator) || denominator === 0) {
                document.getElementById('visualizationResult').innerHTML = 
                    `<span style="color: var(--danger);">请输入有效的分数（分母不能为0）</span>`;
                document.getElementById('visualizationContainer').innerHTML = '';
                return;
            }
            
            document.getElementById('visualizationResult').innerHTML = 
                `分数: <span class="fraction"><span class="numerator">${numerator}</span><span class="denominator">${denominator}</span></span>`;
            
            const container = document.getElementById('visualizationContainer');
            container.innerHTML = '';
            
            const visualFraction = document.createElement('div');
            visualFraction.className = 'visual-fraction';
            
            if (type === 'circle') {
                // 创建圆形可视化
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '150');
                svg.setAttribute('height', '150');
                
                // 创建完整圆形
                const fullCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                fullCircle.setAttribute('cx', '75');
                fullCircle.setAttribute('cy', '75');
                fullCircle.setAttribute('r', '70');
                fullCircle.setAttribute('fill', 'none');
                fullCircle.setAttribute('stroke', '#1d2144');
                fullCircle.setAttribute('stroke-width', '2');
                svg.appendChild(fullCircle);
                
                // 限制最大分母为12，避免显示异常
                const safeDenominator = Math.min(denominator, 12);
                const safeNumerator = Math.min(numerator, safeDenominator);
                
                // 创建分数部分
                for (let i = 0; i < safeNumerator; i++) {
                    const startAngle = (i * 2 * Math.PI) / safeDenominator;
                    const endAngle = ((i + 1) * 2 * Math.PI) / safeDenominator;
                    
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const startX = 75 + 70 * Math.cos(startAngle);
                    const startY = 75 + 70 * Math.sin(startAngle);
                    const endX = 75 + 70 * Math.cos(endAngle);
                    const endY = 75 + 70 * Math.sin(endAngle);
                    
                    const largeArcFlag = (endAngle - startAngle) <= Math.PI ? '0' : '1';
                    
                    const pathData = [
                        `M 75 75`,
                        `L ${startX} ${startY}`,
                        `A 70 70 0 ${largeArcFlag} 1 ${endX} ${endY}`,
                        'Z'
                    ].join(' ');
                    
                    path.setAttribute('d', pathData);
                    path.setAttribute('fill', '#4a6cf7');
                    path.setAttribute('opacity', '0.7');
                    svg.appendChild(path);
                }
                
                visualFraction.appendChild(svg);
                
                // 添加提示
                if (denominator > 12) {
                    document.getElementById('visualizationResult').innerHTML += 
                        '<br><small>提示：分母超过12时，仅显示前12份以保证可视化效果</small>';
                }
            } else {
                // 创建矩形可视化
                const totalParts = Math.min(denominator, 12); // 限制最大分母
                const filledParts = Math.min(numerator, totalParts); // 限制分子不超过分母
                
                for (let i = 0; i < totalParts; i++) {
                    const part = document.createElement('div');
                    part.className = 'fraction-part';
                    
                    const partWidth = 150;
                    const partHeight = 150 / totalParts;
                    
                    part.style.width = `${partWidth}px`;
                    part.style.height = `${partHeight}px`;
                    part.style.top = `${i * partHeight}px`;
                    part.style.left = '0';
                    
                    if (i < filledParts) {
                        part.style.backgroundColor = '#4a6cf7';
                    } else {
                        part.style.backgroundColor = '#e0e0e0';
                    }
                    
                    visualFraction.appendChild(part);
                }
                
                // 添加提示
                if (denominator > 12) {
                    document.getElementById('visualizationResult').innerHTML += 
                        '<br><small>提示：分母超过12时，仅显示前12份以保证可视化效果</small>';
                }
                if (numerator > denominator) {
                    document.getElementById('visualizationResult').innerHTML += 
                        '<br><small>提示：分子大于分母时，仅显示到分母部分</small>';
                }
            }
            
            container.appendChild(visualFraction);
        }

        // 初始化可视化
        document.getElementById('updateVisualization').addEventListener('click', updateVisualization);

        // 比较分数功能
        function compareFractions() {
            const num1 = parseInt(document.getElementById('num1').value);
            const den1 = parseInt(document.getElementById('den1').value);
            const num2 = parseInt(document.getElementById('num2').value);
            const den2 = parseInt(document.getElementById('den2').value);
            
            if (isNaN(num1) || isNaN(den1) || den1 === 0 || isNaN(num2) || isNaN(den2) || den2 === 0) {
                document.getElementById('comparisonResult').innerHTML = 
                    '<span style="color: var(--danger);">请输入有效的分数（分母不能为0）</span>';
                return;
            }
            
            const value1 = num1 / den1;
            const value2 = num2 / den2;
            
            let resultText = '';
            if (value1 > value2) {
                resultText = `<span class="fraction"><span class="numerator">${num1}</span><span class="denominator">${den1}</span></span> 大于 <span class="fraction"><span class="numerator">${num2}</span><span class="denominator">${den2}</span></span>`;
            } else if (value1 < value2) {
                resultText = `<span class="fraction"><span class="numerator">${num1}</span><span class="denominator">${den1}</span></span> 小于 <span class="fraction"><span class="numerator">${num2}</span><span class="denominator">${den2}</span></span>`;
            } else {
                resultText = `<span class="fraction"><span class="numerator">${num1}</span><span class="denominator">${den1}</span></span> 等于 <span class="fraction"><span class="numerator">${num2}</span><span class="denominator">${den2}</span></span>`;
            }
            
            document.getElementById('comparisonResult').innerHTML = resultText;
            updateComparisonVisualization();
        }

        document.getElementById('compareBtn').addEventListener('click', compareFractions);

        // 更新比较可视化
        function updateComparisonVisualization() {
            const num1 = parseInt(document.getElementById('num1').value);
            const den1 = parseInt(document.getElementById('den1').value);
            const num2 = parseInt(document.getElementById('num2').value);
            const den2 = parseInt(document.getElementById('den2').value);
            
            // 更新第一个分数可视化
            const fraction1 = document.getElementById('compareFraction1');
            fraction1.innerHTML = '';
            
            const safeDen1 = Math.min(den1, 12);
            const safeNum1 = Math.min(num1, safeDen1);
            
            for (let i = 0; i < safeDen1; i++) {
                const part = document.createElement('div');
                part.className = 'fraction-part';
                
                const partWidth = 150 / safeDen1;
                const partHeight = 150;
                
                part.style.width = `${partWidth}px`;
                part.style.height = `${partHeight}px`;
                part.style.left = `${i * partWidth}px`;
                part.style.top = '0';
                
                if (i < safeNum1) {
                    part.style.backgroundColor = '#4a6cf7';
                } else {
                    part.style.backgroundColor = '#e0e0e0';
                }
                
                fraction1.appendChild(part);
            }
            
            // 更新第二个分数可视化
            const fraction2 = document.getElementById('compareFraction2');
            fraction2.innerHTML = '';
            
            const safeDen2 = Math.min(den2, 12);
            const safeNum2 = Math.min(num2, safeDen2);
            
            for (let i = 0; i < safeDen2; i++) {
                const part = document.createElement('div');
                part.className = 'fraction-part';
                
                const partWidth = 150 / safeDen2;
                const partHeight = 150;
                
                part.style.width = `${partWidth}px`;
                part.style.height = `${partHeight}px`;
                part.style.left = `${i * partWidth}px`;
                part.style.top = '0';
                
                if (i < safeNum2) {
                    part.style.backgroundColor = '#f0932b';
                } else {
                    part.style.backgroundColor = '#e0e0e0';
                }
                
                fraction2.appendChild(part);
            }
        }

        // 最大公约数函数
        function gcd(a, b) {
            // 处理负数
            a = Math.abs(a);
            b = Math.abs(b);
            return b === 0 ? a : gcd(b, a % b);
        }

        // 练习统计变量
        let practiceStats = {
            score: 0,
            correct: 0,
            incorrect: 0,
            total: 0,
            currentQuestion: null,
            isPracticeActive: false,
            submitted: false
        };

        // 更新进度条
        function updateProgressBar() {
            const progress = (practiceStats.total > 0) ? (practiceStats.correct / practiceStats.total) * 100 : 0;
            document.getElementById('practiceProgress').style.width = `${progress}%`;
        }

        // 开始练习
        document.getElementById('startPractice').addEventListener('click', function() {
            practiceStats.isPracticeActive = true;
            practiceStats.submitted = false;
            
            // 重置统计信息
            practiceStats.score = 0;
            practiceStats.correct = 0;
            practiceStats.incorrect = 0;
            practiceStats.total = 0;
            
            updatePracticeStats();
            updateProgressBar();
            
            document.getElementById('practiceContainer').style.display = 'block';
            document.getElementById('nextQuestion').style.display = 'inline-block';
            document.getElementById('nextQuestion').disabled = true;
            
            generatePracticeQuestion();
        });

        // 下一题
        document.getElementById('nextQuestion').addEventListener('click', function() {
            if (practiceStats.isPracticeActive && !practiceStats.submitted) {
                // 如果未提交答案，提示用户先提交
                alert('请先提交当前题的答案！');
                return;
            }
            if (practiceStats.isPracticeActive) {
                practiceStats.submitted = false;
                generatePracticeQuestion();
            }
        });

        // 生成练习题目（简化版）
        function generatePracticeQuestion() {
            const practiceType = document.getElementById('practiceType').value;
            const difficulty = document.getElementById('difficulty').value;
            
            // 隐藏之前的反馈和解决方案
            document.getElementById('practiceFeedback').style.display = 'none';
            document.getElementById('practiceFeedback').className = '';
            document.getElementById('practiceFeedback').textContent = '';
            document.getElementById('practiceSolution').style.display = 'none';
            document.getElementById('practiceSolution').innerHTML = '';
            
            // 清空选项容器
            const optionsContainer = document.getElementById('multipleChoiceOptions');
            optionsContainer.innerHTML = '';
            optionsContainer.style.display = 'none';
            
            // 清空输入框
            document.getElementById('answerNum').value = '';
            document.getElementById('answerDen').value = '';
            document.getElementById('inputAnswer').style.display = 'none';
            
            // 隐藏提交按钮容器，稍后根据题型显示
            document.getElementById('submitBtnContainer').style.display = 'none';
            
            // 根据类型和难度生成题目（简化版）
            let question;
            const num1 = Math.floor(Math.random() * 8) + 1;
            const den1 = Math.floor(Math.random() * 8) + 1;
            const num2 = Math.floor(Math.random() * 8) + 1;
            const den2 = Math.floor(Math.random() * 8) + 1;
            
            switch(practiceType) {
                case 'comparison':
                    question = {
                        type: 'comparison',
                        question: `比较这两个分数: <span class="fraction"><span class="numerator">${num1}</span><span class="denominator">${den1}</span></span> 和 <span class="fraction"><span class="numerator">${num2}</span><span class="denominator">${den2}</span></span>`,
                        options: ['>', '<', '='],
                        correctAnswer: num1/den1 > num2/den2 ? '>' : num1/den1 < num2/den2 ? '<' : '=',
                        explanation: `因为 ${num1}/${den1} = ${(num1/den1).toFixed(2)} 而 ${num2}/${den2} = ${(num2/den2).toFixed(2)}`
                    };
                    break;
                case 'simplification':
                    const gcdVal = gcd(num1, den1);
                    question = {
                        type: 'simplification',
                        question: `将分数 <span class="fraction"><span class="numerator">${num1}</span><span class="denominator">${den1}</span></span> 简化到最简形式`,
                        correctAnswer: { numerator: num1/gcdVal, denominator: den1/gcdVal },
                        explanation: `分子和分母的最大公约数是 ${gcdVal}，所以 ${num1}/${den1} = ${num1/gcdVal}/${den1/gcdVal}`
                    };
                    break;
                case 'addition':
                    const addResultNum = num1 * den2 + num2 * den1;
                    const addResultDen = den1 * den2;
                    const addGcd = gcd(addResultNum, addResultDen);
                    question = {
                        type: 'operation',
                        question: `计算: <span class="fraction"><span class="numerator">${num1}</span><span class="denominator">${den1}</span></span> + <span class="fraction"><span class="numerator">${num2}</span><span class="denominator">${den2}</span></span>`,
                        correctAnswer: { numerator: addResultNum/addGcd, denominator: addResultDen/addGcd },
                        explanation: `步骤: 1) 找到公分母: ${den1} × ${den2} = ${den1*den2}<br>2) 转换分数: ${num1}/${den1} = ${num1*den2}/${den1*den2}, ${num2}/${den2} = ${num2*den1}/${den1*den2}<br>3) 相加: ${num1*den2 + num2*den1}/${den1*den2}<br>4) 简化: ${addResultNum/addGcd}/${addResultDen/addGcd}`
                    };
                    break;
                default:
                    question = {
                        type: 'comparison',
                        question: `比较这两个分数: <span class="fraction"><span class="numerator">${num1}</span><span class="denominator">${den1}</span></span> 和 <span class="fraction"><span class="numerator">${num2}</span><span class="denominator">${den2}</span></span>`,
                        options: ['>', '<', '='],
                        correctAnswer: num1/den1 > num2/den2 ? '>' : num1/den1 < num2/den2 ? '<' : '=',
                        explanation: `因为 ${num1}/${den1} = ${(num1/den1).toFixed(2)} 而 ${num2}/${den2} = ${(num2/den2).toFixed(2)}`
                    };
            }
            
            practiceStats.currentQuestion = question;
            displayPracticeQuestion(question);
        }

        // 显示练习题目
        function displayPracticeQuestion(question) {
            if (!question) return;
            
            document.getElementById('practiceQuestion').innerHTML = question.question;
            
            // 根据题目类型显示不同的答题界面
            if (question.type === 'comparison') {
                document.getElementById('multipleChoiceOptions').style.display = 'grid';
                document.getElementById('inputAnswer').style.display = 'none';
                document.getElementById('submitBtnContainer').style.display = 'block';
                
                const optionsContainer = document.getElementById('multipleChoiceOptions');
                optionsContainer.innerHTML = '';
                
                question.options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.textContent = option;
                    optionElement.addEventListener('click', function() {
                        // 如果已经提交了答案，不允许再选择
                        if (practiceStats.submitted) return;
                        
                        // 移除其他选项的选中状态
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        // 选中当前选项
                        this.classList.add('selected');
                        
                        // 启用提交按钮
                        document.getElementById('submitAnswer').disabled = false;
                    });
                    optionsContainer.appendChild(optionElement);
                });
                
                // 初始禁用提交按钮
                document.getElementById('submitAnswer').disabled = true;
            } else {
                document.getElementById('multipleChoiceOptions').style.display = 'none';
                document.getElementById('inputAnswer').style.display = 'flex';
                document.getElementById('submitBtnContainer').style.display = 'block';
                
                // 清空输入框
                document.getElementById('answerNum').value = '';
                document.getElementById('answerDen').value = '';
                
                // 初始禁用提交按钮
                document.getElementById('submitAnswer').disabled = true;
                
                // 添加输入事件监听器
                const answerNumInput = document.getElementById('answerNum');
                const answerDenInput = document.getElementById('answerDen');
                
                function enableSubmitIfInputsFilled() {
                    const numFilled = answerNumInput.value.trim() !== '';
                    const denFilled = answerDenInput.value.trim() !== '';
                    document.getElementById('submitAnswer').disabled = !(numFilled && denFilled);
                }
                
                // 移除旧的事件监听器
                answerNumInput.removeEventListener('input', enableSubmitIfInputsFilled);
                answerDenInput.removeEventListener('input', enableSubmitIfInputsFilled);
                
                // 添加新的事件监听器
                answerNumInput.addEventListener('input', enableSubmitIfInputsFilled);
                answerDenInput.addEventListener('input', enableSubmitIfInputsFilled);
            }
            
            // 重置提交按钮状态
            const submitBtn = document.getElementById('submitAnswer');
            submitBtn.textContent = '提交答案';
            
            // 移除之前的事件监听器并添加新的事件监听器
            submitBtn.onclick = function() {
                checkPracticeAnswer();
            };
        }

        // 提交答案按钮事件
        document.getElementById('submitAnswer').addEventListener('click', checkPracticeAnswer);

        // 动画演示功能（简化版）
        function resetAnimation() {
            // 动画重置逻辑
            document.getElementById('animStepDescription').textContent = '点击"开始动画"按钮开始演示';
        }

        document.getElementById('startAnimation').addEventListener('click', function() {
            document.getElementById('animStepDescription').textContent = '动画演示开始...';
            document.getElementById('playAnimation').disabled = false;
            document.getElementById('nextStep').disabled = false;
        });

        // 分数运算设置问题（简化版）
        function setupOperationProblem() {
            // 设置运算问题
            document.getElementById('operationSymbol').textContent = '+';
        }

        // 确保所有必要的函数都可用
        console.log('所有功能已加载完成！');
    </script>
</body>
</html>